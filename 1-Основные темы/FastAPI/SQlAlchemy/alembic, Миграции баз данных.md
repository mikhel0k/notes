## Настройка alembic
Миграция - это какое-то изменение состояния базы данных, именно ее полей, связей, структуры, создание новой модели или удаление и т.д.

Чтобы проинициализировать alembic у себя в проекте необходимо написать команду 
```
alembic init -t asyn migration
```
где migration это название папки в которой будут созданы миграции, можно выбрать другое но общепринятых названия два для этой папки, это либо migration либо alembic. После выполнения этой команды создастся файл alembic.ini и папка название которой вы указали. Нас интересует файл env.py, в папке migration, в нем необходимо импортировать базовый класс моделей, и все модели.
```
from core import (get_db_url, BaseModel, Book, BookCopy, PhysicalBook, AudioBook, Ebook, Author, Review)
```
А также функцию при помощи которой мы берем ссылку в базу данных.

Ну и дальше надо переопределить некоторые параметры, чтобы alembic следил за изменениями в моделях и использовал правильную ссылку для подключения к базе данных:
```
config.set_main_option("sqlalchemy.url", get_db_url())
target_metadata = BaseModel.metadata
```

Также по документации необходимо указать путь к корневой папке проекта для корректной работы alembic, сделать это просто:
```
import os  
import sys
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
```

## Работа с миграциями
Чтобы создать миграцию необходимо прописать команду
```
alembic revision --autogenerate -m "Название миграции"
```
В папке migration/versions создастся файл который будет изменять текущее состояние базы данных к текущему состоянию моделей SQLAlchemy

Чтобы применить миграцию надо написать 
```
alembic apgrade head
```
Чтобы откатить 
```
alembic downgrade -1
```