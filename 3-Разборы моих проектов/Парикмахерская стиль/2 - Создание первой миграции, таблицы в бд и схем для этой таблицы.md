
Создал базовую SQLAlchemy модель для того чтобы собирать метадату для миграций alembic.
```
from sqlalchemy.orm import DeclarativeBase  
  
  
class BaseModel(DeclarativeBase):  
    __abstract__ = True
```

Написал конфигурацию для migrations/env.py
```  
from settings import settings  
from app.models import BaseModel

config.set_main_option("sqlalchemy.url", settings.SYNC_DATABASE_URL)
target_metadata = BaseModel.metadata
```
И сделал первую пустую миграцию
```
alembic revision --autogenerate -m "init db"
```

Прописал после этого первую таблицу 
```
from sqlalchemy import Column, Integer, String  
  
from .Base import BaseModel  
  
  
class User(BaseModel):  
    __tablename__ = 'users'  
    id = Column(Integer, primary_key=True, autoincrement=True, nullable=False)  
    phone_number = Column(String(20), nullable=False)
```
обязательно в ней наследуюсь от базового класса чтобы алембик видел ее.

После этого добавил в migration/env.py ссылку на класс User, и запустил миграцию
```
alembic revision --autogenerate -m "create user table"
```

А также написал pydantic схемы для работы с этой сущностью
```
from typing import Annotated  
  
import phonenumbers  
from pydantic import BaseModel, Field, ConfigDict, field_validator  
  
  
class UserSchema(BaseModel):  
    phone_number: Annotated[str, Field(..., description="Phone number")]  
  
    @field_validator("phone_number", mode="before")  
    @classmethod  
    def validate_phone_number(cls, v):  
        if not v:  
            raise ValueError("phone_number cannot be empty")  
  
        try:  
            parsed = phonenumbers.parse(str(v), "RU")  
            if phonenumbers.is_valid_number(parsed):  
                return phonenumbers.format_number(parsed, phonenumbers.PhoneNumberFormat.E164)  
            raise ValueError('Invalid phone')  
        except:  
            raise ValueError('Invalid phone format')  
  
  
class UserCreate(UserSchema):  
    pass  
  
  
class UserResponse(UserSchema):  
    id: Annotated[int, Field(..., description="User id")]  
  
    model_config = ConfigDict(from_attributes=True)
```